
<!DOCTYPE html>
<html>
<head>
	<title>Login</title>
	<meta name="Description" content="Practica 4 PAT para login">
	<meta charset="utf-8">
	<meta lang="es">

	<!--Link necesario para el css de bootstrap-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

	<style type="text/css">
		
		.estancoColors{
			background-color: #8B0000;
		}
	</style>

</head>
<body>

	<header class="container-fluid estancoColors py-5">

		<div class="row">
			<h1 class="display-1 text-warning text-center">ESTANCO VIRTUAL</h1>
		</div>

		<div class="row">
			<p class="lead text-warning text-center">Bienvenido a tu estanco de confianza desde casa</p>
		<div>
	</header>


	<div class="container py-5">


		<div class="row">

			<h3 class="display-3 text-secondary text-center">IDENTIFICATE</h3>

		</div>

		<div class="row">

			<form id="login-form">
				<fieldset>
				  <div class="form-group">
				    <label for="userName">Indica tu nombre de usuario</label>
					<input class="form-control" id="userName" type="text" minlength="5" title="Indica tu nombre de usuario" required >
				  </div>

				   <div class="form-group">
				    <label for="password">Indica la contraseña:</label>
				    <input class="form-control" id="password"  type="password" minlength="5" maxlength="15" title="Indica tu constraseña" required>
				  </div>

				   <div class="form-group mt-5">
				  	<div class="row">
				  		<button type="submit" class="btn btn-outline-warning btn-lg btn-block" id="enviar">Login!</button>
				  	</div>
				  </div>

				</fieldset>
			</form>
		</div>

	<div class="row mt-4">

		<a class="lead text-center link-secondary" href="register.html"> Todavía no estas registrado? Pincha aquí</a>
	</div>

	</div>

	<footer class="container-fluid estancoColors py-5 mt-5">

		<div class="container-fluid rounded border border-2 border-warning col-6">
			<p class="lead text-warning text-center">Derechos reservados</p>
		</div>

	</footer>

</body>

<script type="text/javascript">
	
	var habilitado=false;
	var user={};

	function loginFunction(evento){

		evento.preventDefault();

		let userName= document.getElementById("userName").value;
		let password=document.getElementById("password").value;

		user={firstName:"", lastName:"", userName:userName, password:password, email:""};

		fetch("http://localHost:8080/api/users/login",{

			method:"POST",
			headers:{
				"Content-Type":"application/json",
				"Accept": "application/json"
			},

			body:JSON.stringify(user)

		})

		.then(function(response){
			if(response.ok){

				return response.json();
			}else{
				throw response;
			}
		})

		.then(function (r){

			if(r){

				alert("Bienvenido: "+userName);
				habilitado=true;
				window.location.replace("home.html");
			}else{
				alert("No existe ningun usuario: "+userName+" con esa contraseña");
			}

		})

		.catch(error=>console.error(error))

	}

	const formulario= document.getElementById("login-form");

	formulario.addEventListener("submit", loginFunction);

</script>
</html>